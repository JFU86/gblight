(function(){var c=/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|SCRIPT|NOSCRIPT|STYLE)$/i;var d=/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i;var b=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g;this.MooEditable=new Class({Implements:[Events,Options],options:{toolbar:true,cleanup:true,paragraphise:false,xhtml:true,semantics:true,actions:"smiley | bold italic underline | insertunorderedlist insertorderedlist | createlink unlink",handleSubmit:true,handleLabel:true,disabled:false,baseCSS:"html{ height: 100%; cursor: text; } body{ font-family: sans-serif; }",extraCSS:"",externalCSS:"",html:'<!DOCTYPE html><html><head><meta charset="UTF-8">{BASEHREF}<style>{BASECSS} {EXTRACSS}</style>{EXTERNALCSS}</head><body></body></html>',rootElement:"",baseURL:"",dimensions:null},initialize:function(f,e){if(!("contentEditable" in document.body)&&!("designMode" in document)){return}this.setOptions(e);this.textarea=document.id(f);this.textarea.store("MooEditable",this);this.actions=this.options.actions.clean().split(" ");this.keys={};this.dialogs={};this.protectedElements=[];this.actions.each(function(i){var g=MooEditable.Actions[i];if(!g){return}if(g.options){var h=g.options.shortcut;if(h){this.keys[h]=i}}if(g.dialogs){Object.each(g.dialogs,function(k,j){k=k.attempt(this);k.name=i+":"+j;if(typeOf(this.dialogs[i])!="object"){this.dialogs[i]={}}this.dialogs[i][j]=k},this)}if(g.events){Object.each(g.events,function(j,k){this.addEvent(k,j)},this)}}.bind(this));this.render()},toElement:function(){return this.textarea},render:function(){var e=this;var f=this.options.dimensions||this.textarea.getSize();this.container=new Element("div",{id:(this.textarea.id)?this.textarea.id+"-mooeditable-container":null,"class":"mooeditable-container",styles:{width:f.x}});this.textarea.addClass("mooeditable-textarea").setStyle("height",f.y);this.iframe=new IFrame({"class":"mooeditable-iframe",frameBorder:0,src:'javascript:""',styles:{height:f.y}});this.toolbar=new MooEditable.UI.Toolbar({onItemAction:function(){var g=Array.from(arguments);var h=g[0];e.action(h.name,g)}});this.attach.delay(1,this);if(this.options.handleLabel&&this.textarea.id){$$('label[for="'+this.textarea.id+'"]').addEvent("click",function(g){if(e.mode!="iframe"){return}g.preventDefault();e.focus()})}if(this.options.handleSubmit){this.form=this.textarea.getParent("form");if(this.form){this.form.addEvent("submit",function(){if(e.mode=="iframe"){e.saveContent()}})}}this.fireEvent("render",this)},attach:function(){var e=this;this.mode="iframe";this.editorDisabled=false;this.container.wraps(this.textarea);this.textarea.setStyle("display","none");this.iframe.setStyle("display","").inject(this.textarea,"before");Object.each(this.dialogs,function(k,j){Object.each(k,function(m){document.id(m).inject(e.iframe,"before");var l;m.addEvents({open:function(){l=e.selection.getRange();e.editorDisabled=true;e.toolbar.disable(j);e.fireEvent("dialogOpen",this)},close:function(){e.toolbar.enable();e.editorDisabled=false;e.focus();if(l){e.selection.setRange(l)}e.fireEvent("dialogClose",this)}})})});this.win=this.iframe.contentWindow;this.doc=this.win.document;if(Browser.name=="firefox"){this.doc.designMode="On"}var g=this.options.html.substitute({BASECSS:this.options.baseCSS,EXTRACSS:this.options.extraCSS,EXTERNALCSS:(this.options.externalCSS)?'<link rel="stylesheet" href="'+this.options.externalCSS+'">':"",BASEHREF:(this.options.baseURL)?'<base href="'+this.options.baseURL+'" />':""});this.doc.open();this.doc.write(g);this.doc.close();(Browser.name=="ie")?this.doc.body.contentEditable=true:this.doc.designMode="On";Object.append(this.win,new Window);Object.append(this.doc,new Document);if(Browser.Element){var h=this.win.Element.prototype;for(var i in Element){if(!i.test(/^[A-Z]|\$|prototype|mooEditable/)){h[i]=Element.prototype[i]}}}else{document.id(this.doc.body)}this.setContent(this.textarea.get("value"));this.doc.addEvents({mouseup:this.editorMouseUp.bind(this),mousedown:this.editorMouseDown.bind(this),mouseover:this.editorMouseOver.bind(this),mouseout:this.editorMouseOut.bind(this),mouseenter:this.editorMouseEnter.bind(this),mouseleave:this.editorMouseLeave.bind(this),contextmenu:this.editorContextMenu.bind(this),click:this.editorClick.bind(this),dblclick:this.editorDoubleClick.bind(this),keypress:this.editorKeyPress.bind(this),keyup:this.editorKeyUp.bind(this),keydown:this.editorKeyDown.bind(this),focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)});this.win.addEvents({focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)});["cut","copy","paste"].each(function(j){e.doc.body.addListener(j,e["editor"+j.capitalize()].bind(e))});this.textarea.addEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener",this.keyListener.bind(this)));if(Browser.name=="firefox"&&Browser.version==2){this.doc.addEvent("focus",function(){e.win.fireEvent("focus").focus()})}if(this.doc.addEventListener){this.doc.addEventListener("focus",function(){e.win.fireEvent("focus")},true)}if(!Browser.name=="ie"&&!Browser.name=="opera"){var f=function(){e.execute("styleWithCSS",false,false);e.doc.removeEvent("focus",f)};this.win.addEvent("focus",f)}if(this.options.toolbar){document.id(this.toolbar).inject(this.container,"top");this.toolbar.render(this.actions)}if(this.options.disabled){this.disable()}this.selection=new MooEditable.Selection(this.win);this.oldContent=this.getContent();this.fireEvent("attach",this);return this},detach:function(){this.saveContent();this.textarea.setStyle("display","").removeClass("mooeditable-textarea").inject(this.container,"before");this.textarea.removeEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener"));this.container.dispose();this.fireEvent("detach",this);return this},enable:function(){this.editorDisabled=false;this.toolbar.enable();return this},disable:function(){this.editorDisabled=true;this.toolbar.disable();return this},editorFocus:function(f){this.oldContent="";this.fireEvent("editorFocus",[f,this])},editorBlur:function(f){this.oldContent=this.saveContent().getContent();this.fireEvent("editorBlur",[f,this])},editorMouseUp:function(f){if(this.editorDisabled){f.stop();return}if(this.options.toolbar){this.checkStates()}this.fireEvent("editorMouseUp",[f,this])},editorMouseDown:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseDown",[f,this])},editorMouseOver:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseOver",[f,this])},editorMouseOut:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseOut",[f,this])},editorMouseEnter:function(f){if(this.editorDisabled){f.stop();return}if(this.oldContent&&this.getContent()!=this.oldContent){this.focus();this.fireEvent("editorPaste",[f,this])}this.fireEvent("editorMouseEnter",[f,this])},editorMouseLeave:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseLeave",[f,this])},editorContextMenu:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorContextMenu",[f,this])},editorClick:function(g){if(Browser.name=="safari"||Browser.name=="chrome"){var f=g.target;if(Element.get(f,"tag")=="img"){if(this.options.baseURL){if(f.getProperty("src").indexOf("http://")==-1){f.setProperty("src",this.options.baseURL+f.getProperty("src"))}}this.selection.selectNode(f);this.checkStates()}}this.fireEvent("editorClick",[g,this])},editorDoubleClick:function(f){this.fireEvent("editorDoubleClick",[f,this])},editorKeyPress:function(f){if(this.editorDisabled){f.stop();return}this.keyListener(f);this.fireEvent("editorKeyPress",[f,this])},editorKeyUp:function(f){if(this.editorDisabled){f.stop();return}var g=f.code;if(this.options.toolbar&&(/^enter|left|up|right|down|delete|backspace$/i.test(f.key)||(g>=33&&g<=36)||g==45||f.meta||f.control)){if(Browser.name=="ie"&&Browser.version==6){clearTimeout(this.checkStatesDelay);this.checkStatesDelay=this.checkStates.delay(500,this)}else{this.checkStates()}}this.fireEvent("editorKeyUp",[f,this])},editorKeyDown:function(k){if(this.editorDisabled){k.stop();return}if(k.key=="enter"){if(this.options.paragraphise){if(k.shift&&(Browser.name=="safari"||Browser.name=="chrome")){var o=this.selection;var f=o.getRange();var n=this.doc.createElement("br");f.insertNode(n);f.setStartAfter(n);f.setEndAfter(n);o.setRange(f);if(o.getSelection().focusNode==n.previousSibling){var m=this.doc.createTextNode("\u00a0");var g=n.parentNode;var l=n.nextSibling;(l)?g.insertBefore(m,l):g.appendChild(m);o.selectNode(m);o.collapse(1)}this.win.scrollTo(0,Element.getOffsets(o.getRange().startContainer).y);k.preventDefault()}else{if(Browser.name=="firefox"||Browser.name=="safari"||Browser.name=="chrome"){var i=this.selection.getNode();var h=Element.getParents(i).include(i).some(function(e){return e.nodeName.test(c)});if(!h){this.execute("insertparagraph")}}}}else{if(Browser.name=="ie"){var f=this.selection.getRange();var i=this.selection.getNode();if(f&&i.get("tag")!="li"){this.selection.insertContent("<br>");this.selection.collapse(false)}k.preventDefault()}}}if(Browser.name=="opera"){var j=k.control||k.meta;if(j&&k.key=="x"){this.fireEvent("editorCut",[k,this])}else{if(j&&k.key=="c"){this.fireEvent("editorCopy",[k,this])}else{if((j&&k.key=="v")||(k.shift&&k.code==45)){this.fireEvent("editorPaste",[k,this])}}}}this.fireEvent("editorKeyDown",[k,this])},editorCut:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorCut",[f,this])},editorCopy:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorCopy",[f,this])},editorPaste:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorPaste",[f,this])},keyListener:function(h){var f=(Browser.platform)=="mac"?h.meta:h.control;if(!f||!this.keys[h.key]){return}h.preventDefault();var g=this.toolbar.getItem(this.keys[h.key]);g.action(h)},focus:function(){(this.mode=="iframe"?this.win:this.textarea).focus();this.fireEvent("focus",this);return this},action:function(g,e){var f=MooEditable.Actions[g];if(f.command&&typeOf(f.command)=="function"){f.command.apply(this,e)}else{this.focus();this.execute(g,false,e);if(this.mode=="iframe"){this.checkStates()}}},execute:function(g,f,e){if(this.busy){return}this.busy=true;this.doc.execCommand(g,f,e);this.saveContent();this.busy=false;return false},toggleView:function(){this.fireEvent("beforeToggleView",this);if(this.mode=="textarea"){this.mode="iframe";this.iframe.setStyle("display","");this.setContent(this.textarea.value);this.textarea.setStyle("display","none")}else{this.saveContent();this.mode="textarea";this.textarea.setStyle("display","");this.iframe.setStyle("display","none")}this.fireEvent("toggleView",this);this.focus.delay(10,this);return this},getContent:function(){var e=this.protectedElements;var f=this.doc.body.get("html").replace(/<!-- mooeditable:protect:([0-9]+) -->/g,function(h,g){return e[g.toInt()]});return this.cleanup(this.ensureRootElement(f))},setContent:function(f){var e=this.protectedElements;f=f.replace(b,function(g){e.push(g);return"<!-- mooeditable:protect:"+(e.length-1)+" -->"});this.doc.body.set("html",this.ensureRootElement(f));return this},saveContent:function(){if(this.mode=="iframe"){this.textarea.set("value",this.getContent())}return this},ensureRootElement:function(l){if(this.options.rootElement){var j=new Element("div",{html:l.trim()});var g=-1;var o=false;var p="";var h=j.childNodes.length;for(var n=0;n<h;n++){var e=j.childNodes[n];var q=e.nodeName;if(!q.test(c)&&q!=="#comment"){if(q==="#text"){if(e.nodeValue.trim()){if(g<0){g=n}p+=e.nodeValue}}else{if(g<0){g=n}p+=new Element("div").adopt($(e).clone()).get("html")}}else{o=true}if(n==(h-1)){o=true}if(g>=0&&o){var f=new Element(this.options.rootElement,{html:p});j.replaceChild(f,j.childNodes[g]);for(var m=g+1;m<n;m++){j.removeChild(j.childNodes[m]);h--;n--;m--}g=-1;o=false;p=""}}l=j.get("html").replace(/\n\n/g,"")}return l},checkStates:function(){var e=this.selection.getNode();if(!e){return}if(typeOf(e)!="element"){return}this.actions.each(function(h){var k=this.toolbar.getItem(h);if(!k){return}k.deactivate();var l=MooEditable.Actions[h]["states"];if(!l){return}if(typeOf(l)=="function"){l.attempt([document.id(e),k],this);return}try{if(this.doc.queryCommandState(h)){k.activate();return}}catch(j){}if(l.tags){var g=e;do{var n=g.tagName.toLowerCase();if(l.tags.contains(n)){k.activate(n);break}}while((g=Element.getParent(g))!=null)}if(l.css){var g=e;do{var m=false;for(var f in l.css){var i=l.css[f];if(g.style[f.camelCase()].contains(i)){k.activate(i);m=true}}if(m||g.tagName.test(c)){break}}while((g=Element.getParent(g))!=null)}}.bind(this))},cleanup:function(f){if(!this.options.cleanup){return f.trim()}do{var e=f;if(this.options.baseURL){f=f.replace('="'+this.options.baseURL,'="')}f=f.replace(/<br class\="webkit-block-placeholder">/gi,"<br />");f=f.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1");f=f.replace(/ class="Apple-style-span"/gi,"");f=f.replace(/<span style="">/gi,"");f=f.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>\u00a0</p>");f=f.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>");if(!this.options.semantics){f=f.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>")}if(this.options.xhtml){f=f.replace(/<br>/gi,"<br />")}if(this.options.semantics){if(Browser.name=="ie"){f=f.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>")}if(Browser.name=="safari"||Browser.name=="chrome"){f=f.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>");f=f.replace(/<div>(.+?)<\/div>/ig,"<p>$1</p>")}if(!Browser.name=="ie"){f=f.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>");f=f.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>")}f=f.replace(/<br[^>]*><\/p>/g,"</p>");f=f.replace(/<p>\s*(<img[^>]+>)\s*<\/p>/ig,"$1\n");f=f.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n");f=f.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n");f=f.replace(/><li>/g,">\n\t<li>");f=f.replace(/([^\n])<\/(ol|ul)>/g,"$1\n</$2>");f=f.replace(/([^\n])<img/ig,"$1\n<img");f=f.replace(/^\s*$/g,"")}f=f.replace(/<br ?\/?>$/gi,"");f=f.replace(/^<br ?\/?>/gi,"");if(this.options.paragraphise){f=f.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>")}f=f.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1");f=f.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>");f=f.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>");f=f.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>");f=f.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");f=f.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>');f=f.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1");f=f.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1");f=f.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1");f=f.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,"$1");f=f.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1");f=f.replace(/<[^> ]*/g,function(g){return g.toLowerCase()});f=f.replace(/<[^>]*>/g,function(g){g=g.replace(/ [^=]+=/g,function(h){return h.toLowerCase()});return g});f=f.replace(/<[^!][^>]*>/g,function(g){g=g.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return g});if(this.options.xhtml){f=f.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />")}f=f.replace(/<p>(?:\s*)<p>/g,"<p>");f=f.replace(/<\/p>\s*<\/p>/g,"</p>");f=f.replace(/<pre[^>]*>.*?<\/pre>/gi,function(g){return g.replace(/<br ?\/?>/gi,"\n")});f=f.trim()}while(f!=e);return f}});MooEditable.Selection=new Class({initialize:function(e){this.win=e},getSelection:function(){this.win.focus();return(this.win.getSelection)?this.win.getSelection():this.win.document.selection},getRange:function(){var f=this.getSelection();if(!f){return null}try{return f.rangeCount>0?f.getRangeAt(0):(f.createRange?f.createRange():null)}catch(g){return this.doc.body.createTextRange()}},setRange:function(e){if(e.select){Function.attempt(function(){e.select()})}else{var f=this.getSelection();if(f.addRange){f.removeAllRanges();f.addRange(e)}}},selectNode:function(g,h){var f=this.getRange();var e=this.getSelection();if(f.moveToElementText){Function.attempt(function(){f.moveToElementText(g);f.select()})}else{if(e.addRange){h?f.selectNodeContents(g):f.selectNode(g);e.removeAllRanges();e.addRange(f)}else{e.setBaseAndExtent(g,0,g,1)}}return g},isCollapsed:function(){var e=this.getRange();if(e.item){return false}return e.boundingWidth==0||this.getSelection().isCollapsed},collapse:function(e){var g=this.getRange();var f=this.getSelection();if(g.select){g.collapse(e);g.select()}else{e?f.collapseToStart():f.collapseToEnd()}},getContent:function(){var g=this.getRange();var e=new Element("body");if(this.isCollapsed()){return""}if(g.cloneContents){e.appendChild(g.cloneContents())}else{if(g.item!=undefined||g.htmlText!=undefined){e.set("html",g.item?g.item(0).outerHTML:g.htmlText)}else{e.set("html",g.toString())}}var f=e.get("html");return f},getText:function(){var f=this.getRange();var e=this.getSelection();return this.isCollapsed()?"":f.text||(e.toString?e.toString():"")},getNode:function(){var f=this.getRange();if(!Browser.name=="ie"||Browser.version>=9){var e=null;if(f){e=f.commonAncestorContainer;if(!f.collapsed){if(f.startContainer==f.endContainer){if(f.startOffset-f.endOffset<2){if(f.startContainer.hasChildNodes()){e=f.startContainer.childNodes[f.startOffset]}}}}while(typeOf(e)!="element"){e=e.parentNode}}return document.id(e)}return document.id(f.item?f.item(0):f.parentElement())},insertContent:function(h){if(Browser.name=="ie"){var g=this.getRange();if(g.pasteHTML){g.pasteHTML(h);g.collapse(false);g.select()}else{if(g.insertNode){g.deleteContents();if(g.createContextualFragment){g.insertNode(g.createContextualFragment(h))}else{var i=this.win.document;var f=i.createDocumentFragment();var e=i.createElement("div");f.appendChild(e);e.outerHTML=h;g.insertNode(f)}}}}else{this.win.document.execCommand("insertHTML",false,h)}}});var a={};MooEditable.Locale={define:function(e,f){if(typeOf(window.Locale)!="null"){return Locale.define("en-US","MooEditable",e,f)}if(typeOf(e)=="object"){Object.merge(a,e)}else{a[e]=f}},get:function(e){if(typeOf(window.Locale)!="null"){return Locale.get("MooEditable."+e)}return e?a[e]:""}};MooEditable.Locale.define({ok:"OK",cancel:"Cancel",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",unorderedList:"Unordered List",orderedList:"Ordered List",indent:"Indent",outdent:"Outdent",undo:"Undo",redo:"Redo",removeHyperlink:"Remove Hyperlink",addHyperlink:"Add Hyperlink",selectTextHyperlink:"Please select the text you wish to hyperlink.",enterURL:"Enter URL",enterImageURL:"Enter image URL",addImage:"Add Image",toggleView:"Toggle View"});MooEditable.UI={};MooEditable.UI.Toolbar=new Class({Implements:[Events,Options],options:{"class":""},initialize:function(e){this.setOptions(e);this.el=new Element("div",{"class":"mooeditable-ui-toolbar "+this.options["class"]});this.items={};this.content=null},toElement:function(){return this.el},render:function(e){if(this.content){this.el.adopt(this.content)}else{this.content=e.map(function(f){if(f=="|"){return this.addSeparator()}else{if(f=="/"){return this.addLineSeparator()}}return this.addItem(f)}.bind(this))}return this},addItem:function(j){var f=this;var e=MooEditable.Actions[j];if(!e){return}var h=e.type||"button";var g=e.options||{};var i=new MooEditable.UI[h.camelCase().capitalize()](Object.append(g,{name:j,"class":j+"-item toolbar-item",title:e.title,onAction:f.itemAction.bind(f)}));this.items[j]=i;document.id(i).inject(this.el);return i},getItem:function(e){return this.items[e]},addSeparator:function(){return new Element("span.toolbar-separator").inject(this.el)},addLineSeparator:function(){return new Element("div.toolbar-line-separator").inject(this.el)},itemAction:function(){this.fireEvent("itemAction",arguments)},disable:function(e){Object.each(this.items,function(f){(f.name==e)?f.activate():f.deactivate().disable()});return this},enable:function(){Object.each(this.items,function(e){e.enable()});return this},show:function(){this.el.setStyle("display","");return this},hide:function(){this.el.setStyle("display","none");return this}});MooEditable.UI.Button=new Class({Implements:[Events,Options],options:{title:"",name:"",text:"Button","class":"",shortcut:"",mode:"icon"},initialize:function(e){this.setOptions(e);this.name=this.options.name;this.render()},toElement:function(){return this.el},render:function(){var f=this;var g=(Browser.platform)=="mac"?"Cmd":"Ctrl";var e=(this.options.shortcut)?" ( "+g+"+"+this.options.shortcut.toUpperCase()+" )":"";var i=this.options.title||name;var h=i+e;this.el=new Element("button",{"class":"mooeditable-ui-button "+f.options["class"],title:h,html:'<span class="button-icon"></span><span class="button-text">'+i+"</span>",events:{click:f.click.bind(f),mousedown:function(j){j.preventDefault()}}});if(this.options.mode!="icon"){this.el.addClass("mooeditable-ui-button-"+this.options.mode)}this.active=false;this.disabled=false;if(Browser.name=="ie"){this.el.addEvents({mouseenter:function(j){this.addClass("hover")},mouseleave:function(j){this.removeClass("hover")}})}return this},click:function(f){f.preventDefault();if(this.disabled){return}this.action(f)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){if(this.active){this.el.removeClass("onActive")}if(!this.disabled){return}this.disabled=false;this.el.removeClass("disabled").set({disabled:false,opacity:1});return this},disable:function(){if(this.disabled){return}this.disabled=true;this.el.addClass("disabled").set({disabled:true,opacity:0.4});return this},activate:function(){if(this.disabled){return}this.active=true;this.el.addClass("onActive");return this},deactivate:function(){this.active=false;this.el.removeClass("onActive");return this}});MooEditable.UI.Dialog=new Class({Implements:[Events,Options],options:{"class":"",contentClass:""},initialize:function(g,f){this.setOptions(f);this.html=g;var e=this;this.el=new Element("div",{"class":"mooeditable-ui-dialog "+e.options["class"],html:'<div class="dialog-content '+e.options.contentClass+'">'+g+"</div>",styles:{display:"none"},events:{click:e.click.bind(e)}})},toElement:function(){return this.el},click:function(){this.fireEvent("click",arguments);return this},open:function(){this.el.setStyle("display","");this.fireEvent("open",this);return this},close:function(){this.el.setStyle("display","none");this.fireEvent("close",this);return this}});MooEditable.UI.AlertDialog=function(f){if(!f){return}var e=f+' <button class="dialog-ok-button">'+MooEditable.Locale.get("ok")+"</button>";return new MooEditable.UI.Dialog(e,{"class":"mooeditable-alert-dialog",onOpen:function(){var g=this.el.getElement(".dialog-ok-button");(function(){g.focus()}).delay(10)},onClick:function(g){g.preventDefault();if(g.target.tagName.toLowerCase()!="button"){return}if(document.id(g.target).hasClass("dialog-ok-button")){this.close()}}})};MooEditable.UI.PromptDialog=function(g,h,f){if(!g){return}var e='<label class="dialog-label">'+g+' <input type="text" class="text dialog-input" value="'+h+'"></label> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(e,{"class":"mooeditable-prompt-dialog",onOpen:function(){var i=this.el.getElement(".dialog-input");(function(){i.focus();i.select()}).delay(10)},onClick:function(l){l.preventDefault();if(l.target.tagName.toLowerCase()!="button"){return}var j=document.id(l.target);var i=this.el.getElement(".dialog-input");if(j.hasClass("dialog-cancel-button")){i.set("value",h);this.close()}else{if(j.hasClass("dialog-ok-button")){var k=i.get("value");i.set("value",h);this.close();if(f){f.attempt(k,this)}}}}})};MooEditable.Actions={bold:{title:MooEditable.Locale.get("bold"),options:{shortcut:"b"},states:{tags:["b","strong"],css:{"font-weight":"bold"}},events:{beforeToggleView:function(){if(Browser.name=="firefox"){var e=this.textarea.get("value");var f=e.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");if(e!=f){this.textarea.set("value",f)}}},attach:function(){if(Browser.name=="firefox"){var e=this.textarea.get("value");var f=e.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");if(e!=f){this.textarea.set("value",f);this.setContent(f)}}}}},italic:{title:MooEditable.Locale.get("italic"),options:{shortcut:"i"},states:{tags:["i","em"],css:{"font-style":"italic"}},events:{beforeToggleView:function(){if(Browser.name=="firefox"){var e=this.textarea.get("value");var f=e.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");if(e!=f){this.textarea.set("value",f)}}},attach:function(){if(Browser.name=="firefox"){var e=this.textarea.get("value");var f=e.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");if(e!=f){this.textarea.set("value",f);this.setContent(f)}}}}},underline:{title:MooEditable.Locale.get("underline"),options:{shortcut:"u"},states:{tags:["u"],css:{"text-decoration":"underline"}},events:{beforeToggleView:function(){if(Browser.name=="firefox"||Browser.name=="ie"){var e=this.textarea.get("value");var f=e.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");if(e!=f){this.textarea.set("value",f)}}},attach:function(){if(Browser.name=="firefox"||Browser.name=="ie"){var e=this.textarea.get("value");var f=e.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");if(e!=f){this.textarea.set("value",f);this.setContent(f)}}}}},insertunorderedlist:{title:MooEditable.Locale.get("unorderedList"),states:{tags:["ul"]}},insertorderedlist:{title:MooEditable.Locale.get("orderedList"),states:{tags:["ol"]}},undo:{title:MooEditable.Locale.get("undo"),options:{shortcut:"z"}},redo:{title:MooEditable.Locale.get("redo"),options:{shortcut:"y"}},unlink:{title:MooEditable.Locale.get("removeHyperlink")},createlink:{title:MooEditable.Locale.get("addHyperlink"),options:{shortcut:"l"},states:{tags:["a"]},dialogs:{alert:MooEditable.UI.AlertDialog.pass(MooEditable.Locale.get("selectTextHyperlink")),prompt:function(e){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterURL"),"http://",function(f){e.execute("createlink",false,f.trim())})}},command:function(){var f=this.selection;var h=this.dialogs.createlink;if(f.isCollapsed()){var g=f.getNode();if(g.get("tag")=="a"&&g.get("href")){f.selectNode(g);var e=h.prompt;e.el.getElement(".dialog-input").set("value",g.get("href"));e.open()}else{h.alert.open()}}else{var i=f.getText();var e=h.prompt;if(d.test(i)){e.el.getElement(".dialog-input").set("value",i)}e.open()}}},toggleview:{title:MooEditable.Locale.get("toggleView"),command:function(){(this.mode=="textarea")?this.toolbar.enable():this.toolbar.disable("toggleview");this.toggleView()}}};MooEditable.Actions.Settings={};Element.Properties.mooeditable={get:function(){return this.retrieve("MooEditable")}};Element.implement({mooEditable:function(e){var f=this.get("mooeditable");if(!f){f=new MooEditable(this,e)}return f}})})();